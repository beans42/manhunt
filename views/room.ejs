<html>
	<style>
		table, th, td {
			padding: 3px;
			border: 1px solid black;
			border-collapse: collapse
		}
	</style>

	<table>
		<tbody id="player_list"></tbody>
	</table>

	<script src="/socket.io/socket.io.js"></script>
	<script>
		var socket = io();
		let name = prompt("Enter a name: ");
		let socket_id = "";
		socket.emit("join room", { room_id: '<%= room_id %>', user_name: name, longitude: 0, latitude: 0 });

		function update_display(data) {
			delete data.players[socket_id];
			let table = document.getElementById("player_list");
			table.innerHTML = "<tr><th>Name</th><th>Longitude</th><th>Latitude</th></tr>";
			for (const entry in data.players) {
				player = data.players[entry];
				let new_row = document.createElement("tr");
				table.appendChild(new_row);
				let cell1 = document.createElement("td");
				cell1.textContent = player.name;
				new_row.appendChild(cell1);
				let cell2 = document.createElement("td");
				cell2.textContent = player.longitude;
				new_row.appendChild(cell2);
				let cell3 = document.createElement("td");
				cell3.textContent = player.latitude;
				new_row.appendChild(cell3);
			}
		}

		function send_to_server(data) {
			socket.emit("position update", { longitude: data.coords.longitude, latitude: data.coords.latitude });
		}

		socket.on("join acknowledgement", (data) => {
			if (data.user === name)
				socket_id = data.socket;
			socket.on("position update", update_display);
			navigator.geolocation.watchPosition(send_to_server, () => { return; }, { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 });
		});
	</script>
</html>